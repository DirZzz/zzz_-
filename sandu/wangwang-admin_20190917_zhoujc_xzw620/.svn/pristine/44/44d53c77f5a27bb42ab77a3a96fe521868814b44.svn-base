<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.service.statisticsHouse.dao.HouseStatisticsHourMapper">

    <select id="selectHourHouseList" parameterType="com.sandu.api.statisticsHouse.model.HouseStatistics"
            resultType="com.sandu.api.statisticsHouse.model.HouseStatistics">
        select
            id,
        <if test="type == 1">
            sum(new_house_count) newHouseCount,
        </if>
        <if test="type == 0">
            sum(use_house_count) useHouseCount,
        </if>
        start_time
        from
            data_statistics.bigdata_house_statistics_2b_hour
        where is_deleted = 0
        <if test="type == 1">
            and new_house_count &lt;&gt; 0
        </if>
        <if test="type == 0">
            and use_house_count &lt;&gt; 0
        </if>
        <if test="provinceCode != null and provinceCode != '' ">
            and province_code = #{provinceCode,jdbcType=VARCHAR}
        </if>
        <if test="cityCode != null and cityCode != '' ">
            and city_code = #{cityCode,jdbcType=VARCHAR}
        </if>
        <if test="time == 0">
            and TO_DAYS( NOW( ) ) - TO_DAYS(start_time) = 1
        </if>
        group by start_time
        ORDER BY start_time DESC
    </select>

    <select id="selectHourHouseTotal" parameterType="com.sandu.api.statisticsHouse.model.HouseStatistics"
            resultType="com.sandu.api.statisticsHouse.model.HouseStatistics">
        select
        sum(new_house_count) as newHouseTotal,
        sum(use_house_count) as useHouseTotal
        from
        data_statistics.bigdata_house_statistics_2b_hour
        where is_deleted = 0
        <if test="provinceCode != null and provinceCode != '' ">
            and province_code = #{provinceCode,jdbcType=VARCHAR}
        </if>
        <if test="cityCode != null and cityCode != '' ">
            and city_code = #{cityCode,jdbcType=VARCHAR}
        </if>
        <if test="time == 0">
            and TO_DAYS(NOW()) - TO_DAYS(start_time) = 1
        </if>
    </select>


    <select id="selectHourHouseChart" parameterType="com.sandu.api.statisticsHouse.model.HouseStatistics"
            resultType="com.sandu.api.statisticsHouse.model.HouseStatistics">
        SELECT
        a.timehoure as startTime,
        IFNULL ( c.newCount, 0 ) as newHouseCount,
        IFNULL ( c.useCount, 0 ) as useHouseCount
        FROM
        (select 0 AS timehoure union select 1 union select 2 union select 3 union select 4 union select 5 union
        select 6 union select 7 union select 8 union select 9 union select 10 union select 11 union select 12 union
        select 13 union select 14 union select 15 union select 16 union select 17 union select 18 union select 19 union
        select 20 union select 21 union select 22 union select 23) a
        LEFT JOIN (
        SELECT
        DATE_FORMAT ( b.start_time, '%H' ) AS times,
        sum(b.new_house_count) AS newCount,
        sum(b.use_house_count) AS useCount
        FROM
        data_statistics.bigdata_house_statistics_2b_hour b
        where b.is_deleted = 0
        <if test="provinceCode != null and provinceCode != '' ">
            and province_code = #{provinceCode,jdbcType=VARCHAR}
        </if>
        <if test="cityCode != null and cityCode != '' ">
            and city_code = #{cityCode,jdbcType=VARCHAR}
        </if>
        <if test="time == 0">
            and TO_DAYS( NOW( ) ) - TO_DAYS(b.start_time) = 1
        </if>
        GROUP BY
        DATE_FORMAT ( b.start_time, '%H' )
        ORDER BY
        times
        ) c ON a.timehoure = c.times
        ORDER BY
        a.timehoure ASC
    </select>

</mapper>