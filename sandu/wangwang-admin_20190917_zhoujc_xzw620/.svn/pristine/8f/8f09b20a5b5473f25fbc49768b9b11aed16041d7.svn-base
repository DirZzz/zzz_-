<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.service.solution.dao.MiniProUserAppointmentDetailMapper">

    <select id="findList" parameterType="com.sandu.api.solution.input.UserAppointmentQuery" resultType="com.sandu.api.solution.model.MiniProUserAppointmentDetail">
        SELECT
          *
        FROM
          mini_pro_user_appointment_detail
        WHERE
          is_deleted = 0 AND
          mini_pro_obtain_mobile_detail_id in
          <foreach collection="obtainIds" open="(" separator="," close=")" item="item">
            #{item}
          </foreach>
          <if test="userName != null">
              AND user_name like  concat('%', #{userName}, '%')
          </if>
          <if test="mobile != null">
              AND mobile like concat('%', #{mobile}, '%')
          </if>
          <if test="title != null">
            AND appointment_title like concat('%', #{title}, '%')
          </if>
          <if test="status != null">
            AND status = #{status}
          </if>
          <if test="appointmentTimeStart != null">
            AND appointment_time <![CDATA[>=]]> #{appointmentTimeStart}
         </if>
        <if test="appointmentTimeEnd != null">
            AND appointment_time <![CDATA[<=]]> #{appointmentTimeEnd}
        </if>
        order by appointment_time desc
    </select>
    
    <select id="findById" resultType="com.sandu.api.solution.model.MiniProUserAppointmentDetail">
        SELECT * from  mini_pro_user_appointment_detail where is_deleted = 0 and id = #{id}
    </select>

    <update id="updateRemakeAndStatusById">
        UPDATE
          mini_pro_user_appointment_detail
        set
          remake = #{remake},
          status = #{status},
          gmt_modified = now()
        WHERE
          id = #{id} AND
          is_deleted = 0
    </update>

    <update id="delete">
        UPDATE
          mini_pro_user_appointment_detail
        set
          is_deleted = 1,
          gmt_modified = now()
        WHERE
          id = #{id}
    </update>

    <select id="countByObtainId" resultType="int">
        SELECT count(*) from mini_pro_user_appointment_detail where mini_pro_obtain_mobile_detail_id = #{obtainId} and is_deleted = 0
    </select>

</mapper>